–ó–∞–¥–∞—á–∞: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π 2 –∑–∞–¥–∞—á–∏:
—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö wb –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ö –≤ –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å;
—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–∞—Ö –≤ google-—Ç–∞–±–ª–∏—Ü–∞—Ö.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–°–£–ë–î - PostgreSQL.
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –°–£–ë–î knex.js
–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ - typescript –∏–ª–∏ jsDoc.
Endpoint: https://common-api.wildberries.ru/api/v1/tariffs/box 
(–¢–∞—Ä–∏—Ñ—ã –¥–ª—è –∫–æ—Ä–æ–±–æ–≤ )

–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ google-—Ç–∞–±–ª–∏—Ü–∞–º –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü - N.
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö.

–¢–µ–∑–∏—Å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å compose —Ñ–∞–π–ª.
–†–∞–∑–æ–±—Ä–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö api ‚Äú–¢–∞—Ä–∏—Ñ—ã –∫–æ—Ä–æ–±–æ–≤‚Äù, –≤—ã–±—Ä–∞—Ç—å —Ä–∞–∑—É–º–Ω—É—é —Ñ–æ—Ä–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î.
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
–ù–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ API WB
–ï–∂–µ—á–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ api ‚Äú–¢–∞—Ä–∏—Ñ—ã –∫–æ—Ä–æ–±–æ–≤‚Äù .
–î–∞–Ω–Ω—ã–µ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –≤ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è.
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø–æ–ª—É—á–∞–µ–º–∞—è –µ–∂–µ—á–∞—Å–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–Ω—è, –¥–æ–ª–∂–Ω–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å —É–∂–µ –∏–º–µ—é—â–∏–µ—Å—è –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –¥–∞–Ω–Ω—ã–µ.
–°–æ–∑–¥–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ google-—Ç–∞–±–ª–∏—Ü.
–î–∞–Ω–Ω—ã–µ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –≤ google —Ç–∞–±–ª–∏—Ü–∞—Ö –¥–æ–ª–∂–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è (—Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –ª–∏—Å—Ç –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤ - stocks_coefs).
–î–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞.
–ö–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ GitHub.
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è docker –∏ readme —Å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞.
–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
–°–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö, –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É docker compose up.

–¢–æ–∫–µ–Ω WB API –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω –Ω–∞ —Å–∞–π—Ç–µ hh.ru –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏  –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –¥–µ–¥–ª–∞–π–Ω.

–†–µ–∑—É–ª—å—Ç–∞—Ç

–ì–æ—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ - —ç—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç: 

1) –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
        2) compose —Ñ–∞–π–ª –¥–ª—è docker
        3) readme —Å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–æ –æ–ø–∏—Å–∞—Ç—å —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ—Ç–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ DB –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–∞—Ä–æ–ª—å –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ë–î –ø—Ä–æ–ø–∏—Å–∞—Ç—å - postgres, –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ç.–∫ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ üôÇ.

–°–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–Ω–æ–π docker compose up –∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π.

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ db –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å knex –∏–ª–∏ pg


–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –µ—ë –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —à–∞–±–ª–æ–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–∞ btlz-wb-test. –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –Ω–∞ –µ–≥–æ –æ—Å–Ω–æ–≤–µ, –ø—Ä–æ–≤–µ—Ä–∏–º –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.


–ü–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏—Å–ª–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ Git –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–∞ HH üëç


Gracefully stopping... (press Ctrl+C again to force)
[+] Stopping 2/2
 ‚úî Container app       Stopped                                                         0.0s 
 ‚úî Container postgres  Stopped                                                         0.2s 
MacBook-Pro-L:btlz-wb-test ls$ clear
MacBook-Pro-L:btlz-wb-test ls$ clear
MacBook-Pro-L:btlz-wb-test ls$ docker compose down --rmi local --volumes
[+] Running 5/5
 ‚úî Container app                      Remov...                 0.0s 
 ‚úî Container postgres                 Removed                  0.0s 
 ‚úî Image btlz-wb-test-app:latest      Removed                  0.0s 
 ‚úî Network btlz-wb-test_postgres-net  Removed                  0.2s 
 ‚úî Volume btlz-wb-test_postgres-vol   Removed                  0.0s 
MacBook-Pro-L:btlz-wb-test ls$ docker compose up --build
Compose can now delegate builds to bake for better performance.
 To do so, set COMPOSE_BAKE=true.
[+] Building 9.3s (16/16) FINISHED             docker:desktop-linux
 => [app internal] load build definition from Dockerfile       0.0s
 => => transferring dockerfile: 415B                           0.0s
 => [app internal] load metadata for docker.io/library/node:2  0.8s
 => [app internal] load .dockerignore                          0.0s
 => => transferring context: 90B                               0.0s
 => [app deps-prod 1/4] FROM docker.io/library/node:20-alpine  0.0s
 => [app internal] load build context                          0.0s
 => => transferring context: 5.21kB                            0.0s
 => CACHED [app deps-prod 2/4] WORKDIR /app                    0.0s
 => CACHED [app deps-prod 3/4] COPY ./package*.json .          0.0s
 => CACHED [app deps-prod 4/4] RUN npm install --omit=dev      0.0s
 => [app build 1/3] RUN npm install --include=dev              6.7s
 => [app build 2/3] COPY . .                                   0.0s
 => [app build 3/3] RUN npm run build                          1.5s
 => CACHED [app prod 3/5] COPY --from=build /app/package*.jso  0.0s
 => CACHED [app prod 4/5] COPY --from=deps-prod /app/node_mod  0.0s
 => [app prod 5/5] COPY --from=build /app/dist ./dist          0.0s
 => [app] exporting to image                                   0.0s
 => => exporting layers                                        0.0s
 => => writing image sha256:2794f7c327d47f4b99c72a4b437d4f291  0.0s
 => => naming to docker.io/library/btlz-wb-test-app            0.0s
 => [app] resolving provenance for metadata file               0.0s
[+] Running 5/5
 ‚úî app                                 Built                   0.0s 
 ‚úî Network btlz-wb-test_postgres-net   Created                 0.0s 
 ‚úî Volume "btlz-wb-test_postgres-vol"  Created                 0.0s 
 ‚úî Container postgres                  Created                 0.0s 
 ‚úî Container app                       Crea...                 0.0s 
Attaching to app, postgres
postgres  | The files belonging to this database system will be owned by user "postgres".
postgres  | This user must also own the server process.
postgres  | 
postgres  | The database cluster will be initialized with locale "en_US.utf8".
postgres  | The default database encoding has accordingly been set to "UTF8".
postgres  | The default text search configuration will be set to "english".
postgres  | 
postgres  | Data page checksums are disabled.
postgres  | 
postgres  | fixing permissions on existing directory /var/lib/postgresql/data/pgdata ... ok
postgres  | creating subdirectories ... ok
postgres  | selecting dynamic shared memory implementation ... posix
postgres  | selecting default max_connections ... 100
postgres  | selecting default shared_buffers ... 128MB
postgres  | selecting default time zone ... UTC
postgres  | creating configuration files ... ok
postgres  | running bootstrap script ... ok
postgres  | sh: locale: not found
postgres  | 2025-07-03 22:16:08.219 UTC [31] WARNING:  no usable system locales were found
postgres  | performing post-bootstrap initialization ... ok
postgres  | initdb: warning: enabling "trust" authentication for local connections
postgres  | initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
postgres  | syncing data to disk ... ok
postgres  | 
postgres  | 
postgres  | Success. You can now start the database server using:
postgres  | 
postgres  |     pg_ctl -D /var/lib/postgresql/data/pgdata -l logfile start
postgres  | 
postgres  | waiting for server to start....2025-07-03 22:16:08.483 UTC [37] LOG:  starting PostgreSQL 16.1 on aarch64-unknown-linux-musl, compiled by gcc (Alpine 13.2.1_git20231014) 13.2.1 20231014, 64-bit
postgres  | 2025-07-03 22:16:08.483 UTC [37] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
postgres  | 2025-07-03 22:16:08.486 UTC [40] LOG:  database system was shut down at 2025-07-03 22:16:08 UTC
postgres  | 2025-07-03 22:16:08.488 UTC [37] LOG:  database system is ready to accept connections
postgres  |  done
postgres  | server started
postgres  | 
postgres  | /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
postgres  | 
postgres  | waiting for server to shut down....2025-07-03 22:16:08.593 UTC [37] LOG:  received fast shutdown request
postgres  | 2025-07-03 22:16:08.594 UTC [37] LOG:  aborting any active transactions
postgres  | 2025-07-03 22:16:08.595 UTC [37] LOG:  background worker "logical replication launcher" (PID 43) exited with exit code 1
postgres  | 2025-07-03 22:16:08.596 UTC [38] LOG:  shutting down
postgres  | 2025-07-03 22:16:08.597 UTC [38] LOG:  checkpoint starting: shutdown immediate
postgres  | 2025-07-03 22:16:08.600 UTC [38] LOG:  checkpoint complete: wrote 3 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.002 s, sync=0.001 s, total=0.005 s; sync files=2, longest=0.001 s, average=0.001 s; distance=0 kB, estimate=0 kB; lsn=0/14F0480, redo lsn=0/14F0480
postgres  | 2025-07-03 22:16:08.602 UTC [37] LOG:  database system is shut down
postgres  |  done
postgres  | server stopped
postgres  | 
postgres  | PostgreSQL init process complete; ready for start up.
postgres  | 
postgres  | 2025-07-03 22:16:08.713 UTC [1] LOG:  starting PostgreSQL 16.1 on aarch64-unknown-linux-musl, compiled by gcc (Alpine 13.2.1_git20231014) 13.2.1 20231014, 64-bit
postgres  | 2025-07-03 22:16:08.714 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
postgres  | 2025-07-03 22:16:08.714 UTC [1] LOG:  listening on IPv6 address "::", port 5432
postgres  | 2025-07-03 22:16:08.715 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
postgres  | 2025-07-03 22:16:08.718 UTC [51] LOG:  database system was shut down at 2025-07-03 22:16:08 UTC
postgres  | 2025-07-03 22:16:08.721 UTC [1] LOG:  database system is ready to accept connections
app       | 
app       | > btlz-test@1.0.0 start
app       | > node dist/app.js
app       | 
app       | Batch 1 ran the following migrations:
app       | - 20250227184908_spreadsheets.js
app       | Ran 1 seed files
app       | - spreadsheets.js
app       | All migrations and seeds have been run
postgres  | 2025-07-03 22:21:08.802 UTC [49] LOG:  checkpoint starting: time
postgres  | 2025-07-03 22:21:19.568 UTC [49] LOG:  checkpoint complete: wrote 107 buffers (0.7%); 0 WAL file(s) added, 0 removed, 0 recycled; write=10.748 s, sync=0.011 s, total=10.766 s; sync files=55, longest=0.002 s, average=0.001 s; distance=461 kB, estimate=461 kB; lsn=0/1563A30, redo lsn=0/15639F8

–°—É–¥—è –ø–æ –ª–æ–≥–∞–º, PostgreSQL —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ `database system is ready to accept connections`), –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `app` –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ –æ—à–∏–±–æ–∫.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–µ–Ω–Ω–æ –ª–æ–≥–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ (—É—Å–ø–µ—à–Ω—ã–µ –∏–ª–∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è), —Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é PostgreSQL –ø–∏—à–µ—Ç —Ç–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∏, –Ω–æ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω—ã–º.

---

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤ PostgreSQL (–≤ Docker)

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `docker-compose.yaml` –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `postgres` –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `command`:

```yaml
services:
  postgres:
    image: postgres:16.1-alpine
    environment:
      POSTGRES_USER: youruser
      POSTGRES_PASSWORD: yourpassword
      POSTGRES_DB: yourdb
    command:
      - postgres
      - -c
      - log_connections=on
      - -c
      - log_disconnections=on
      - -c
      - log_statement=all
    ...
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `postgresql.conf` —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ).

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker compose down
docker compose up -d
```

3. –¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `postgres` –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∫–∞–∂–¥–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏, –∞ —Ç–∞–∫–∂–µ –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.

---

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
docker compose logs -f postgres
```

–í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞:

```
LOG:  connection authorized: user=youruser database=yourdb application_name=psql
LOG:  disconnection: session time: ...
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –æ–Ω–∏ —Ç–æ–∂–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã.

---

### –ò—Ç–æ–≥

- –õ–æ–≥–∏ –∏–∑ –≤–∞—à–µ–≥–æ –≤—ã–≤–æ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –±–∞–∑–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.
- –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤–∫–ª—é—á–∏—Ç–µ `log_connections` –∏ `log_disconnections`.
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `postgres` —á–µ—Ä–µ–∑ `docker compose logs postgres`.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ç–æ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π.


–í –ª–æ–≥–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–æ–∫–∞–∑–∞–ª–∏, –≤–∏–¥–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ PostgreSQL, –∞ –∑–∞—Ç–µ–º –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ (fast shutdown request). –û–¥–Ω–∞–∫–æ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –∏–ª–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PostgreSQL –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å—ã.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –∑–∞–ø—Ä–æ—Å–æ–≤?

1. **–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π**  
–î–æ–±–∞–≤—å—Ç–µ –≤ `docker-compose.yml` –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ postgres –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```yaml
services:
  postgres:
    image: postgres:16.1-alpine
    environment:
      POSTGRES_USER: youruser
      POSTGRES_PASSWORD: yourpassword
      POSTGRES_DB: yourdb
    command:
      - postgres
      - -c
      - log_connections=on
      - -c
      - log_disconnections=on
      - -c
      - log_statement=all
```

–≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç PostgreSQL –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∏ –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```bash
docker compose down
docker compose up -d
```

3. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–Ω–æ–≤–∞:**

```bash
docker compose logs -f postgres
```

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞:

```
LOG: connection authorized: user=youruser database=yourdb application_name=yourapp
LOG: disconnection: session time: ...
LOG: statement: SELECT ...
```

---

### –ü–æ—á–µ–º—É –≤ —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–∞—Ö –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π?

- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—Ç –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–µ—Ä–≤–µ—Ä–∞.
- –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –Ω–æ PostgreSQL –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –í–∫–ª—é—á–µ–Ω–∏–µ `log_connections` –∏ `log_statement` –¥–∞—Å—Ç –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

---

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ `sh: locale: not found` –∏ `no usable system locales were found`. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –æ–±—Ä–∞–∑–æ–º Alpine –∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –ø–∞–∫–µ—Ç `locales` –∏–ª–∏ `glibc` –≤ –æ–±—Ä–∞–∑–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.
- –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è (–∫–∞–∫ –≤ –≤–∞—à–∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ª–æ–≥–∞—Ö), –∑–Ω–∞—á–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –µ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö.

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ç–æ—á–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º `docker-compose.yml` –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è.

// –î–æ–±–∞–≤–ª–µ–Ω–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ knex.ts –¥–ª—è migrate –∏ seed
interface MigrationResult {
  batch: number;
  migrations: string[];
}








—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π 2 –∑–∞–¥–∞—á–∏:
—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö wb –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ö –≤ –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å;
—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–∞—Ö –≤ google-—Ç–∞–±–ª–∏—Ü–∞—Ö.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–°–£–ë–î - PostgreSQL.
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –°–£–ë–î knex.js
–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ - typescript.
Endpoint: https://common-api.wildberries.ru/api/v1/tariffs/box 
(–¢–∞—Ä–∏—Ñ—ã –¥–ª—è –∫–æ—Ä–æ–±–æ–≤ )

–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ google-—Ç–∞–±–ª–∏—Ü–∞–º –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü - N.
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. –≤–æ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —Å —Å–∫–∞—á–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ src/config/knex/knexfile.ts import env from "#config/env/env";
import { Knex } from "knex";
import { z } from "zod";

const connectionSchema = z.object({
  host: z.string(),
  port: z.number(),
  database: z.string(),
  user: z.string(),
  password: z.string(),
});

const NODE_ENV = env.NODE_ENV ?? "development";

const knegConfigs: Record<typeof NODE_ENV, Knex.Config> = {
  development: {
    client: "pg",
    connection: () =>
      connectionSchema.parse({
        host: env.POSTGRES_HOST ?? "localhost",
        port: env.POSTGRES_PORT ?? 5432,
        database: env.POSTGRES_DB ?? "postgres",
        user: env.POSTGRES_USER ?? "postgres",
        password: env.POSTGRES_PASSWORD ?? "postgres",
      }),
    pool: {
      min: 2,
      max: 10,
    },
    migrations: {
      stub: "src/config/knex/migration.stub.js",
      directory: "./src/postgres/migrations",
      tableName: "migrations",
      extension: "ts",
    },
    seeds: {
      stub: "src/config/knex/seed.stub.js",
      directory: "./src/postgres/seeds",
      extension: "js",
    },
  },
  production: {
    client: "pg",
    connection: () =>
      connectionSchema.parse({
        host: env.POSTGRES_HOST,
        port: env.POSTGRES_PORT,
        database: env.POSTGRES_DB,
        user: env.POSTGRES_USER,
        password: env.POSTGRES_PASSWORD,
      }),
    pool: {
      min: 2,
      max: 10,
    },
    migrations: {
      stub: "dist/config/knex/migration.stub.js",
      directory: "./dist/postgres/migrations",
      tableName: "migrations",
      extension: "js",
    },
    seeds: {
      stub: "src/config/knex/seed.stub.js",
      directory: "./dist/postgres/seeds",
      extension: "js",
    },
  },
};

export default knegConfigs[NODE_ENV];
–≤–æ—Ç postgres/ knex.ts. import _knex from "knex";
import knexConfig from "#config/knex/knexfile";

const knex = _knex(knexConfig);

// –¢–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è migrate –∏ seed
interface MigrationResult {
  batch: number;
  migrations: string[];
}

export default knex;

function logMigrationResults(action: string, result: [number, string[]]) {
  if (result[1].length === 0) {
    console.log(
      ["latest", "up"].includes(action)
        ? "All migrations are up to date"
        : "All migrations have been rolled back"
    );
    return;
  }
  console.log(
    `Batch ${result[0]} ${["latest", "up"].includes(action) ? "ran" : "rolled back"} the following migrations:`
  );
  for (const migration of result[1]) {
    console.log("- " + migration);
  }
}
function logMigrationList(list: [{ name: string }[], { file: string }[]]) {
  console.log(`Found ${list[0].length} Completed Migration file/files.`);
  for (const migration of list[0]) {
    console.log("- " + migration.name);
  }
  console.log(`Found ${list[1].length} Pending Migration file/files.`);
  for (const migration of list[1]) {
    console.log("- " + migration.file);
  }
}

function logSeedRun(result: [string[]]) {
  if (result[0].length === 0) {
    console.log("No seeds to run");
  }
  console.log(`Ran ${result[0].length} seed files`);
  for (const seed of result[0]) {
    console.log("- " + seed?.split(/\/|\\/).pop());
  }
  // Ran 5 seed files
}

function logSeedMake(name: string) {
  console.log(`Created seed: ${name.split(/\/|\\/).pop()}`);
}

export const migrate = {
  latest: async () => {
    logMigrationResults("latest", await knex.migrate.latest());
  },
  rollback: async () => {
    logMigrationResults("rollback", await knex.migrate.rollback());
  },
  down: async (name?: string) => {
    logMigrationResults("down", await knex.migrate.down({ name }));
  },
  up: async (name?: string) => {
    logMigrationResults("up", await knex.migrate.up({ name }));
  },
  list: async () => {
    logMigrationList(await knex.migrate.list());
  },
  make: async (name: string) => {
    if (!name) {
      console.error("Please provide a migration name");
      process.exit(1);
    }
    console.log(await knex.migrate.make(name, { extension: "js" }));
  },
};

export const seed = {
  run: async () => {
    logSeedRun(await knex.seed.run());
  },
  make: async (name: string) => {
    if (!name) {
      console.error("Please provide a seed name");
      process.exit(1);
    }
    logSeedMake(await knex.seed.make(name));
  },
};
–∞ –≤–æ—Ç utils/knex.ts. import { migrate, seed } from "#postgres/knex";
import { Command } from "commander";
const program = new Command();

program
  .command("migrate")
  .argument("[type]", "latest|rollback|status|down|up|list")
  .argument("[arg]", "version")
  .action(async (action, arg) => {
    if (!action) return;
    if (action === "latest") await migrate.latest();
    if (action === "rollback") await migrate.rollback();
    if (action === "down") await migrate.down(arg);
    if (action === "up") await migrate.up(arg);
    if (action === "list") await migrate.list();
    if (action === "make") await migrate.make(arg);
    process.exit(0);
  });
program.command("seed [action] [arg]").action(async (action, arg) => {
  if (!action) return;
  if (action === "run") await seed.run();
  if (action === "make") await seed.make(arg);
  process.exit(0);
});
program.command("default", { isDefault: true }).action(() => {});
program.parse();
–∏ –≤–æ—Ç —Ñ–∞–π–ª app.ts  import knex, { migrate, seed } from "#postgres/knex";

await migrate.latest();
await seed.run();

console.log("All migrations and seeds have been run");
–Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Ç–µ–±–µ –≤—Å–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã —Ç—ã —Å—Ä–∞–∑—É –ø–æ–Ω—è–ª –≤ —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞. –ü–æ–∫–∞–∂–∏  –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –≥–æ—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ  knex
–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –∫–∞–∂–¥—ã–µ 12 —á–∞–æ—Å–≤
–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤


–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –Ω–∞ TypeScript —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Knex.js –∏ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:

1. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã Wildberries –ø–æ API `https://common-api.wildberries.ru/api/v1/tariffs/box` –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
2. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –≤ Google Sheets –ø–æ N —Ç–∞–±–ª–∏—Ü–∞–º (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º).

---

## –ß—Ç–æ —è —Å–¥–µ–ª–∞—é

- –û–ø–∏—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤.
- –°–æ–∑–¥–∞–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.
- –ù–∞–ø–∏—à—É —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ –ë–î.
- –†–µ–∞–ª–∏–∑—É—é —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Google Sheets (—á–µ—Ä–µ–∑ Google Sheets API).
- –ù–∞—Å—Ç—Ä–æ—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (cron) –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —ç—Ç–∏—Ö –∑–∞–¥–∞—á.
- –ò—Å–ø–æ–ª—å–∑—É—é –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ knex –∏ env.

---

# 1. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç–∞—Ä–∏—Ñ–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é `create_tariffs_table.ts` –≤ `src/postgres/migrations/`:

```ts
import { Knex } from "knex";

export async function up(knex: Knex): Promise<void> {
  return knex.schema.createTable("tariffs", (table) => {
    table.increments("id").primary();
    table.string("tariff_id").notNullable().index(); // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π id —Ç–∞—Ä–∏—Ñ–∞ –∏–∑ API
    table.string("name").notNullable();
    table.decimal("price", 10, 2).notNullable();
    table.jsonb("raw_data").notNullable(); // –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    table.date("date").notNullable().index(); // –¥–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∞–∫—Ç—É–∞–ª–µ–Ω —Ç–∞—Ä–∏—Ñ
    table.timestamps(true, true);
    table.unique(["tariff_id", "date"]); // —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞ –Ω–∞ –¥–∞—Ç—É
  });
}

export async function down(knex: Knex): Promise<void> {
  return knex.schema.dropTableIfExists("tariffs");
}
```

---

# 2. –¢–∏–ø—ã TypeScript –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `src/types/tariffs.ts`:

```ts
export interface Tariff {
  tariff_id: string; // id —Ç–∞—Ä–∏—Ñ–∞ –∏–∑ API
  name: string;
  price: number;
  [key: string]: any; // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

---

# 3. –°–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `src/services/tariffsService.ts`:

```ts
import axios from "axios";
import knex from "#postgres/knex";
import { Tariff } from "#types/tariffs";

const WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box";

export async function fetchTariffsFromWB(): Promise<Tariff[]> {
  const response = await axios.get(WB_TARIFFS_URL);
  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ response.data
  return response.data;
}

export async function saveTariffsToDB(tariffs: Tariff[], date: Date): Promise<void> {
  // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å upsert (Postgres ON CONFLICT)
  for (const tariff of tariffs) {
    await knex("tariffs")
      .insert({
        tariff_id: tariff.tariff_id,
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        date,
      })
      .onConflict(["tariff_id", "date"])
      .merge({
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        updated_at: knex.fn.now(),
      });
  }
}

export async function updateTariffs(): Promise<void> {
  const tariffs = await fetchTariffsFromWB();
  const today = new Date();
  const dateString = today.toISOString().split("T")[0]; // yyyy-mm-dd
  await saveTariffsToDB(tariffs, new Date(dateString));
  console.log(`Tariffs updated for date ${dateString}`);
}
```

---

# 4. –°–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Google Sheets

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets –Ω–∞–º –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth2 –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `src/services/googleSheetsService.ts`:

```ts
import { google, sheets_v4 } from "googleapis";
import knex from "#postgres/knex";

const SCOPES = ["https://www.googleapis.com/auth/spreadsheets"];
const GOOGLE_SHEETS_CREDENTIALS = process.env.GOOGLE_SHEETS_CREDENTIALS || ""; // JSON –≤ env
const GOOGLE_SHEETS_TOKEN = process.env.GOOGLE_SHEETS_TOKEN || ""; // JSON –≤ env

// –ü–∞—Ä—Å–∏–º credentials
const credentials = JSON.parse(GOOGLE_SHEETS_CREDENTIALS);

const auth = new google.auth.GoogleAuth({
  credentials,
  scopes: SCOPES,
});

const sheets = google.sheets({ version: "v4", auth });

interface SheetInfo {
  id: string; // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä Google —Ç–∞–±–ª–∏—Ü—ã
  name?: string; // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏–º—è –ª–∏—Å—Ç–∞
}

// –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –≤ –ë–î —Å id —Ç–∞–±–ª–∏—Ü Google Sheets
// –î–ª—è –ø—Ä–∏–º–µ—Ä–∞, —Å–æ–∑–¥–∞–¥–∏–º —Ç–∏–ø –∏ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—É—á–µ–Ω–∏—è —ç—Ç–∏—Ö id
export async function getGoogleSheetIds(): Promise<SheetInfo[]> {
  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –ë–î, –Ω–∞–ø—Ä–∏–º–µ—Ä google_sheets
  // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –∂–µ—Å—Ç–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤
  return [
    { id: "sheetId1", name: "–õ–∏—Å—Ç1" },
    { id: "sheetId2", name: "–¢–∞—Ä–∏—Ñ—ã" },
    // ...
  ];
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã –∏–∑ –ë–î –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã
 */
export async function getTariffsFromDB(date: Date): Promise<any[]> {
  const dateString = date.toISOString().split("T")[0];
  return knex("tariffs")
    .select("tariff_id", "name", "price")
    .where("date", dateString);
}

/**
 * –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Google Sheet
 */
export async function updateGoogleSheet(sheetId: string, data: any[][]): Promise<void> {
  // –û—á–∏—Å—Ç–∏–º –ª–∏—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'Sheet1')
  const range = "Sheet1!A1";

  // –ó–∞–ø–∏—à–µ–º –¥–∞–Ω–Ω—ã–µ
  await sheets.spreadsheets.values.update({
    spreadsheetId: sheetId,
    range,
    valueInputOption: "USER_ENTERED",
    requestBody: {
      values: data,
    },
  });
}

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö Google Sheets
 */
export async function updateGoogleSheetsForTariffs(date: Date): Promise<void> {
  const sheetsInfo = await getGoogleSheetIds();
  const tariffs = await getTariffsFromDB(date);

  // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Google Sheets: –∑–∞–≥–æ–ª–æ–≤–∫–∏ + –¥–∞–Ω–Ω—ã–µ
  const values = [["Tariff ID", "Name", "Price"]];
  for (const t of tariffs) {
    values.push([t.tariff_id, t.name, t.price.toString()]);
  }

  for (const sheet of sheetsInfo) {
    await updateGoogleSheet(sheet.id, values);
    console.log(`Google Sheet ${sheet.id} updated`);
  }
}
```

---

# 5. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `src/scheduler.ts`:

```ts
import cron from "node-cron";
import { updateTariffs } from "./services/tariffsService";
import { updateGoogleSheetsForTariffs } from "./services/googleSheetsService";

function startScheduler() {
  // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–∞—Ä–∏—Ñ—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00
  cron.schedule("0 1 * * *", async () => {
    try {
      console.log("Starting tariffs update...");
      await updateTariffs();

      const today = new Date();
      console.log("Starting Google Sheets update...");
      await updateGoogleSheetsForTariffs(today);

      console.log("All updates completed");
    } catch (error) {
      console.error("Error in scheduled task:", error);
    }
  });

  console.log("Scheduler started");
}

export default startScheduler;
```

---

# 6. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `app.ts`

```ts
import knex, { migrate, seed } from "#postgres/knex";
import startScheduler from "./scheduler";

async function main() {
  await migrate.latest();
  await seed.run();

  console.log("Migrations and seeds completed");

  // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
  startScheduler();
}

main().catch((e) => {
  console.error(e);
  process.exit(1);
});
```

---

# 7. Dockerfile –∏ docker-compose

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –≤ `Dockerfile` –∏ `docker-compose.yml` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è:

- POSTGRES_HOST, POSTGRES_PORT, POSTGRES_DB, POSTGRES_USER, POSTGRES_PASSWORD
- GOOGLE_SHEETS_CREDENTIALS (JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞)
- –î—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

---

# –ò—Ç–æ–≥

- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ç–∞—Ä–∏—Ñ–æ–≤.
- –°–µ—Ä–≤–∏—Å —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ç–∞—Ä–∏—Ñ—ã —Å Wildberries –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –ë–î.
- –°–µ—Ä–≤–∏—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç Google Sheets –ø–æ —Å–ø–∏—Å–∫—É id —Ç–∞–±–ª–∏—Ü.
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç —ç—Ç–∏ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Knex.js –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL.
- –í—Å–µ —Ç–∏–ø—ã –Ω–∞ TypeScript.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Google API, –∏–ª–∏ —Ç–µ—Å—Ç–∞–º–∏.  
–ù–∞–ø–∏—à–∏—Ç–µ, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä docker-compose –∏–ª–∏ –ø–æ–º–æ—â—å —Å OAuth2 –¥–ª—è Google Sheets.


–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ `.env`, `docker-compose.yml` –∏ `Dockerfile`. –ü—Ä–æ–≤–µ—Ä–∏–º –∏ –ø–æ–¥–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –≤–∞—à–µ–º `.env`:

```env
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

APP_PORT=5000

JWT_SECRET=eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwNTIwdjEiLCJ0eXAiOiJKV1QifQ.eyJlbnQiOjEsImV4cCI6MTc2NTY3MDIyOSwiaWQiOiIwMTk3NmU0Yy1mZTgwLTc1NDAtODkyMi02NGE5ZWUzYTU4MzYiLCJpaWQiOjQ1OTExNjA5LCJvaWQiOjExMzA0NiwicyI6MTA3Mzc0MTgzMiwic2lkIjoiOTMyYzE3NmEtNTA4NS01YzZmLWJjMzMtNGU4NGNkZjU4ZDdlIiwidCI6ZmFsc2UsInVpZCI6NDU5MTE2MDl9.wDoH8FLdZu1049uPCmhx3UHaw28YJB-CylWeD2LgkpRZFIMlOsUlnlVmfmYKy__JWNjfbDkOtdJ69QpSD5EKag
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
- –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `POSTGRES_HOST=postgres` (—Ç.–∫. –≤ `docker-compose` —Ö–æ—Å—Ç –±–∞–∑—ã ‚Äî —ç—Ç–æ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ `postgres`).  
- –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GOOGLE_SHEETS_CREDENTIALS` —Å JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Google –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (—ç–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –∫–∞–≤—ã—á–∫–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª –∏ –º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä).  
- –î–æ–±–∞–≤—å—Ç–µ `APP_PORT=5000` (—É–∂–µ –µ—Å—Ç—å).

---

## 2. docker-compose.yml (–≤—ã –Ω–∞–∑–≤–∞–ª–∏ `compose.yaml`)

–í–∞—à–∞ —á–∞—Å—Ç—å `services` –¥–ª—è `postgres` –∏ `app` –≤ —Ü–µ–ª–æ–º –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ. –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ—á–∞–Ω–∏–π:

- –í `postgres`:

  ```yaml
  environment:
    - PGPORT=${POSTGRES_PORT}
    - POSTGRES_DB=${POSTGRES_DB}
    - POSTGRES_USER=${POSTGRES_USER}
    - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    - PGDATA=/var/lib/postgresql/data/pgdata
  ```

  –ó–¥–µ—Å—å `PGPORT` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è PostgreSQL? –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `POSTGRES_PORT`. –ù–æ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º –æ–±—Ä–∞–∑–µ `postgres` –ø–æ—Ä—Ç –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `-p` –≤ `ports`, –∞ –Ω–µ —á–µ—Ä–µ–∑ env.  
  –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å `PGPORT` –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `POSTGRES_PORT`.

- –í `app`:

  ```yaml
  environment:
    POSTGRES_HOST: postgres
    POSTGRES_PORT: ${POSTGRES_PORT}
    POSTGRES_DB: ${POSTGRES_DB}
    POSTGRES_USER: ${POSTGRES_USER}
    POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    PORT: ${APP_PORT}
    NODE_ENV: production
    JWT_SECRET: ${JWT_SECRET}
  ```

  –í—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤—å—Ç–µ `GOOGLE_SHEETS_CREDENTIALS` —Å—é–¥–∞, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

- –ü–æ—Ä—Ç—ã:

  ```yaml
  ports:
    - "5001:5000"
  ```

  –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å–Ω–∞—Ä—É–∂–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Ä—Ç 5001, –∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç 5000 (—Å–æ–≥–ª–∞—Å–Ω–æ `APP_PORT`).

---

## 3. Dockerfile

–í–∞—à `Dockerfile` –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:

- `deps-prod` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–µ–∑ devDependencies.
- `build` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ devDependencies + —Å–±–æ—Ä–∫–∞.
- `prod` ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–≥–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
–í `prod` –æ–±—Ä–∞–∑–µ –Ω–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è `.env` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ª—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `docker-compose` (—á—Ç–æ –≤—ã –∏ –¥–µ–ª–∞–µ—Ç–µ).

---

## 4. –†–µ–∑—é–º–µ –∏ –ø—Ä–∏–º–µ—Ä –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### .env (–ø—Ä–∏–º–µ—Ä)

```env
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

APP_PORT=5000

JWT_SECRET=eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwNTIwdjEiLCJ0eXAiOiJKV1QifQ.eyJlbnQiOjEsImV4cCI6MTc2NTY3MDIyOSwiaWQiOiIwMTk3NmU0Yy1mZTgwLTc1NDAtODkyMi02NGE5ZWUzYTU4MzYiLCJpaWQiOjQ1OTExNjA5LCJvaWQiOjExMzA0NiwicyI6MTA3Mzc0MTgzMiwic2lkIjoiOTMyYzE3NmEtNTA4NS01YzZmLWJjMzMtNGU4NGNkZjU4ZDdlIiwidCI6ZmFsc2UsInVpZCI6NDU5MTE2MDl9.wDoH8FLdZu1049uPCmhx3UHaw28YJB-CylWeD2LgkpRZFIMlOsUlnlVmfmYKy__JWNjfbDkOtdJ69QpSD5EKag

GOOGLE_SHEETS_CREDENTIALS={"type":"service_account","project_id":"...","private_key_id":"...","private_key":"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n","client_email":"...","client_id":"...","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"..."}
```

> –í–Ω–∏–º–∞–Ω–∏–µ: JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, —ç–∫—Ä–∞–Ω–∏—Ä—É—è –ø–µ—Ä–µ–Ω–æ—Å—ã `\n` –∏ –∫–∞–≤—ã—á–∫–∏.

---

### docker-compose.yml (—Å –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏)

```yaml
version: "3.9"

networks:
  postgres-net:
    driver: bridge

volumes:
  postgres-vol:
    driver: local

services:
  postgres:
    container_name: postgres
    image: postgres:16.1-alpine
    environment:
      - POSTGRES_PORT=${POSTGRES_PORT}
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres-vol:/var/lib/postgresql/data
    networks:
      - postgres-net
    expose:
      - ${POSTGRES_PORT}
    ports:
      - "${POSTGRES_PORT}:${POSTGRES_PORT}"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped

  app:
    container_name: app
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: ${POSTGRES_PORT}
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      PORT: ${APP_PORT}
      NODE_ENV: production
      JWT_SECRET: ${JWT_SECRET}
      GOOGLE_SHEETS_CREDENTIALS: ${GOOGLE_SHEETS_CREDENTIALS}
    ports:
      - "5001:${APP_PORT}"
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - postgres-net
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: 5
    command: ["npm", "run", "start"]
    restart: unless-stopped
```

---

## 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- –î–ª—è Google Sheets credentials –ª—É—á—à–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å json —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —á–∏—Ç–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–π JSON –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

```yaml
volumes:
  - ./google-credentials.json:/app/google-credentials.json:ro
```

- –í –∫–æ–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞:

```ts
import { google } from "googleapis";
import path from "path";

const auth = new google.auth.GoogleAuth({
  keyFile: path.join(__dirname, "../google-credentials.json"),
  scopes: ["https://www.googleapis.com/auth/spreadsheets"],
});
```

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –≤–∞—à–µ–º TypeScript –∫–æ–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `process.env.POSTGRES_HOST` –∏ —Ç.–ø.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∏–º–µ—Ä–æ–º —á—Ç–µ–Ω–∏—è Google credentials –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Docker –¥–ª—è —ç—Ç–æ–≥–æ.  
–¢–∞–∫–∂–µ –º–æ–≥—É –ø–æ–º–æ—á—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –∏ Google Sheets.




–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ `.env`, `docker-compose.yml` –∏ `Dockerfile`. –ü—Ä–æ–≤–µ—Ä–∏–º –∏ –ø–æ–¥–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –≤–∞—à–µ–º `.env`:

```env
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

APP_PORT=5000

JWT_SECRET=eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwNTIwdjEiLCJ0eXAiOiJKV1QifQ.eyJlbnQiOjEsImV4cCI6MTc2NTY3MDIyOSwiaWQiOiIwMTk3NmU0Yy1mZTgwLTc1NDAtODkyMi02NGE5ZWUzYTU4MzYiLCJpaWQiOjQ1OTExNjA5LCJvaWQiOjExMzA0NiwicyI6MTA3Mzc0MTgzMiwic2lkIjoiOTMyYzE3NmEtNTA4NS01YzZmLWJjMzMtNGU4NGNkZjU4ZDdlIiwidCI6ZmFsc2UsInVpZCI6NDU5MTE2MDl9.wDoH8FLdZu1049uPCmhx3UHaw28YJB-CylWeD2LgkpRZFIMlOsUlnlVmfmYKy__JWNjfbDkOtdJ69QpSD5EKag
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
- –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `POSTGRES_HOST=postgres` (—Ç.–∫. –≤ `docker-compose` —Ö–æ—Å—Ç –±–∞–∑—ã ‚Äî —ç—Ç–æ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ `postgres`).  
- –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GOOGLE_SHEETS_CREDENTIALS` —Å JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Google –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (—ç–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –∫–∞–≤—ã—á–∫–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª –∏ –º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä).  
- –î–æ–±–∞–≤—å—Ç–µ `APP_PORT=5000` (—É–∂–µ –µ—Å—Ç—å).

---

## 2. docker-compose.yml (–≤—ã –Ω–∞–∑–≤–∞–ª–∏ `compose.yaml`)

–í–∞—à–∞ —á–∞—Å—Ç—å `services` –¥–ª—è `postgres` –∏ `app` –≤ —Ü–µ–ª–æ–º –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ. –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ—á–∞–Ω–∏–π:

- –í `postgres`:

  ```yaml
  environment:
    - PGPORT=${POSTGRES_PORT}
    - POSTGRES_DB=${POSTGRES_DB}
    - POSTGRES_USER=${POSTGRES_USER}
    - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    - PGDATA=/var/lib/postgresql/data/pgdata
  ```

  –ó–¥–µ—Å—å `PGPORT` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è PostgreSQL? –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `POSTGRES_PORT`. –ù–æ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º –æ–±—Ä–∞–∑–µ `postgres` –ø–æ—Ä—Ç –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `-p` –≤ `ports`, –∞ –Ω–µ —á–µ—Ä–µ–∑ env.  
  –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å `PGPORT` –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `POSTGRES_PORT`.

- –í `app`:

  ```yaml
  environment:
    POSTGRES_HOST: postgres
    POSTGRES_PORT: ${POSTGRES_PORT}
    POSTGRES_DB: ${POSTGRES_DB}
    POSTGRES_USER: ${POSTGRES_USER}
    POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    PORT: ${APP_PORT}
    NODE_ENV: production
    JWT_SECRET: ${JWT_SECRET}
  ```

  –í—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤—å—Ç–µ `GOOGLE_SHEETS_CREDENTIALS` —Å—é–¥–∞, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

- –ü–æ—Ä—Ç—ã:

  ```yaml
  ports:
    - "5001:5000"
  ```

  –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å–Ω–∞—Ä—É–∂–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Ä—Ç 5001, –∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç 5000 (—Å–æ–≥–ª–∞—Å–Ω–æ `APP_PORT`).

---

## 3. Dockerfile

–í–∞—à `Dockerfile` –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:

- `deps-prod` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–µ–∑ devDependencies.
- `build` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ devDependencies + —Å–±–æ—Ä–∫–∞.
- `prod` ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–≥–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
–í `prod` –æ–±—Ä–∞–∑–µ –Ω–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è `.env` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ª—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `docker-compose` (—á—Ç–æ –≤—ã –∏ –¥–µ–ª–∞–µ—Ç–µ).

---

## 4. –†–µ–∑—é–º–µ –∏ –ø—Ä–∏–º–µ—Ä –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### .env (–ø—Ä–∏–º–µ—Ä)

```env
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

APP_PORT=5000

JWT_SECRET=eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwNTIwdjEiLCJ0eXAiOiJKV1QifQ.eyJlbnQiOjEsImV4cCI6MTc2NTY3MDIyOSwiaWQiOiIwMTk3NmU0Yy1mZTgwLTc1NDAtODkyMi02NGE5ZWUzYTU4MzYiLCJpaWQiOjQ1OTExNjA5LCJvaWQiOjExMzA0NiwicyI6MTA3Mzc0MTgzMiwic2lkIjoiOTMyYzE3NmEtNTA4NS01YzZmLWJjMzMtNGU4NGNkZjU4ZDdlIiwidCI6ZmFsc2UsInVpZCI6NDU5MTE2MDl9.wDoH8FLdZu1049uPCmhx3UHaw28YJB-CylWeD2LgkpRZFIMlOsUlnlVmfmYKy__JWNjfbDkOtdJ69QpSD5EKag

GOOGLE_SHEETS_CREDENTIALS={"type":"service_account","project_id":"...","private_key_id":"...","private_key":"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n","client_email":"...","client_id":"...","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"..."}
```

> –í–Ω–∏–º–∞–Ω–∏–µ: JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, —ç–∫—Ä–∞–Ω–∏—Ä—É—è –ø–µ—Ä–µ–Ω–æ—Å—ã `\n` –∏ –∫–∞–≤—ã—á–∫–∏.

---

### docker-compose.yml (—Å –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏)

```yaml
version: "3.9"

networks:
  postgres-net:
    driver: bridge

volumes:
  postgres-vol:
    driver: local

services:
  postgres:
    container_name: postgres
    image: postgres:16.1-alpine
    environment:
      - POSTGRES_PORT=${POSTGRES_PORT}
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres-vol:/var/lib/postgresql/data
    networks:
      - postgres-net
    expose:
      - ${POSTGRES_PORT}
    ports:
      - "${POSTGRES_PORT}:${POSTGRES_PORT}"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped

  app:
    container_name: app
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: ${POSTGRES_PORT}
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      PORT: ${APP_PORT}
      NODE_ENV: production
      JWT_SECRET: ${JWT_SECRET}
      GOOGLE_SHEETS_CREDENTIALS: ${GOOGLE_SHEETS_CREDENTIALS}
    ports:
      - "5001:${APP_PORT}"
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - postgres-net
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: 5
    command: ["npm", "run", "start"]
    restart: unless-stopped
```

---

## 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- –î–ª—è Google Sheets credentials –ª—É—á—à–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å json —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —á–∏—Ç–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–π JSON –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

```yaml
volumes:
  - ./google-credentials.json:/app/google-credentials.json:ro
```

- –í –∫–æ–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞:

```ts
import { google } from "googleapis";
import path from "path";

const auth = new google.auth.GoogleAuth({
  keyFile: path.join(__dirname, "../google-credentials.json"),
  scopes: ["https://www.googleapis.com/auth/spreadsheets"],
});
```

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –≤–∞—à–µ–º TypeScript –∫–æ–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `process.env.POSTGRES_HOST` –∏ —Ç.–ø.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∏–º–µ—Ä–æ–º —á—Ç–µ–Ω–∏—è Google credentials –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Docker –¥–ª—è —ç—Ç–æ–≥–æ.  
–¢–∞–∫–∂–µ –º–æ–≥—É –ø–æ–º–æ—á—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –∏ Google Sheets.

–ü–æ–Ω—è–ª, —á—Ç–æ —É –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π Google Sheets, –∏ –≤—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —É–∫–∞–∑–∞–ª–∏ –≤ `.env`:

```env
GOOGLE_SHEETS_CREDENTIALS='any'
```

---

### –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –∏ –¥–µ–ª–∞—Ç—å –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ:

1. **–ü–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π GOOGLE_SHEETS_CREDENTIALS —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**, –Ω–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Google Sheets API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —É–ø–∞–¥—ë—Ç —Å –æ—à–∏–±–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

2. **–ï—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Google Sheets API —Å–µ–π—á–∞—Å, —Ç–æ –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞—Ç—å —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ `docker-compose.yml` –∏ –∫–æ–¥–∞**, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫.

3. **–ï—Å–ª–∏ –∫–æ–¥ –æ–∂–∏–¥–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GOOGLE_SHEETS_CREDENTIALS` ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É, –Ω–æ –ª—É—á—à–µ –≤ –∫–æ–¥–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```ts
const googleSheetsCreds = process.env.GOOGLE_SHEETS_CREDENTIALS;

if (!googleSheetsCreds || googleSheetsCreds === 'any') {
  console.warn('Google Sheets credentials not provided, skipping API initialization');
  // –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Google API
} else {
  // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ creds
}
```

4. **–í `docker-compose.yml` –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫–∞–∫ –µ—Å—Ç—å:**

```yaml
environment:
  ...
  GOOGLE_SHEETS_CREDENTIALS: ${GOOGLE_SHEETS_CREDENTIALS}
```

–∞ –≤ `.env`:

```env
GOOGLE_SHEETS_CREDENTIALS=any
```

(–±–µ–∑ –∫–∞–≤—ã—á–µ–∫, —á—Ç–æ–±—ã –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –∑–Ω–∞—á–µ–Ω–∏–µ).

---

### –ò—Ç–æ–≥:

- –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.  
- –ü–æ–∫–∞ –µ–≥–æ –Ω–µ—Ç ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É –∏–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤–æ–≤—Å–µ.  
- –í –∫–æ–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–ª—é—á–µ–π, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–∞–¥–∞–ª–æ.  
- –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏ ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ `GOOGLE_SHEETS_CREDENTIALS` –≤ `.env` –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π JSON (–≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º).

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–π –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Google API —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.


–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –≤—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –∑–∞–≥–ª—É—à–∫—É –≤ –≤–∏–¥–µ JSON —Å –∫–ª—é—á–∞–º–∏ ‚Äî —ç—Ç–æ –ª—É—á—à–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ `'any'`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é.

–û–¥–Ω–∞–∫–æ, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤:

---

### 1. –§–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è GOOGLE_SHEETS_CREDENTIALS

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å **–≤–∞–ª–∏–¥–Ω—ã–π JSON –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É** —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø–æ–ª—è `private_key`.

–ü—Ä–∏–º–µ—Ä (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π):

```env
GOOGLE_SHEETS_CREDENTIALS={"type":"service_account","project_id":"my-project","private_key_id":"abc123","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEv...\\n-----END PRIVATE KEY-----\\n","client_email":"my-email@my-project.iam.gserviceaccount.com","client_id":"1234567890","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/my-email%40my-project.iam.gserviceaccount.com"}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:

- –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫–∏ –≤ `private_key` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `\\n` (–¥–≤–æ–π–Ω–æ–π —Å–ª—ç—à + n), —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ env.

- –í `.env` **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∏–ª–∏ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤–æ–∫—Ä—É–≥ –≤—Å–µ–≥–æ JSON**, –∏–Ω–∞—á–µ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

---

### 2. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ

–í –∫–æ–¥–µ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```ts
let googleSheetsCredentials;

try {
  googleSheetsCredentials = JSON.parse(process.env.GOOGLE_SHEETS_CREDENTIALS || '{}');
} catch (e) {
  console.error('Failed to parse GOOGLE_SHEETS_CREDENTIALS:', e);
  googleSheetsCredentials = null;
}

if (googleSheetsCredentials && googleSheetsCredentials.type === 'service_account') {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Google API —Å —ç—Ç–∏–º–∏ –∫–ª—é—á–∞–º–∏
} else {
  console.warn('Google Sheets credentials not valid or missing, skipping initialization');
}
```

---

### 3. –ï—Å–ª–∏ —É –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π

- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ Google API –≤—ã–∑–æ–≤—ã –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

- –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∑–∞–≥–ª—É—à–∏—Ç—å –≤—ã–∑–æ–≤—ã Google Sheets API, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–∞–¥–∞–ª–æ.

---

### 4. –í—ã–≤–æ–¥

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `GOOGLE_SHEETS_CREDENTIALS` –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `\n` –∫–∞–∫ `\\n`).

- –í –∫–æ–¥–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç–µ JSON –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏.

- –ü—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∑–∞–≥–ª—É—à–∫—É –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∏–º–µ—Ä–æ–º —Å–∫—Ä–∏–ø—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç JSON –∏–∑ —Ñ–∞–π–ª–∞ –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è `.env`, –∏–ª–∏ —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google Sheets API.


–°—É–¥—è –ø–æ –≤—ã–≤–æ–¥—É `docker-compose up`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `postgres` —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω, –±–∞–∑–∞ –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `app` —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥—ã –±–µ–∑ –æ—à–∏–±–æ–∫.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—à–∏–±–∫–æ–π `getaddrinfo ENOTFOUND postgres` **–∏—Å—á–µ–∑–ª–∞**, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–ø–µ—Ä—å –±–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–µ—Ç–∏ Docker Compose –ø–æ–¥ –∏–º–µ–Ω–µ–º `postgres`.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

- –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ `docker-compose up` ‚Äî —Ç–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –±–∞–∑–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏–¥–∏—Ç –±–∞–∑—É –ø–æ –∏–º–µ–Ω–∏ `postgres`.
- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

  ```bash
  docker-compose up -d
  ```

- –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–≤–Ω–µ Docker), –ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –∏–º—è `postgres` –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `localhost` –∏ –ø–æ—Ä—Ç, –ø—Ä–æ–±—Ä–æ—à–µ–Ω–Ω—ã–π –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

### –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥

- –û—à–∏–±–∫–∞ –±—ã–ª–∞ –≤—ã–∑–≤–∞–Ω–∞ —Ç–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–∞–∑—ã –±—ã–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
- –¢–µ–ø–µ—Ä—å –±–∞–∑–∞ –∑–∞–ø—É—â–µ–Ω–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –Ω–µ–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ.
- –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å!

–û—à–∏–±–∫–∞ `getaddrinfo ENOTFOUND postgres` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `npm run dev` –ª–æ–∫–∞–ª—å–Ω–æ (–≤–Ω–µ Docker) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –∏–º—è —Ö–æ—Å—Ç–∞ `postgres` –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ. –í Docker Compose –∏–º—è `postgres` —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –≤ Docker-—Å–µ—Ç–∏, –Ω–æ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ –æ–Ω–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ.

---

## –ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

- –ö–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up`, –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ Docker-—Å–µ—Ç–∏, –≥–¥–µ `postgres` ‚Äî —ç—Ç–æ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∏ DNS —Ä–µ–∑–æ–ª–≤–∏—Ç –µ–≥–æ.
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `npm run dev` –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ MacBook) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω–µ Docker, –∏ –∏–º—è `postgres` –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ IP, –ø–æ—ç—Ç–æ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞.

---

## –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–ª—è Docker

- –í `.env` –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è Docker:

  ```
  POSTGRES_HOST=postgres
  ```

- –í `.env.local` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º —Ñ–∞–π–ª–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞):

  ```
  POSTGRES_HOST=localhost
  ```

### 2. –ü—Ä–æ–±—Ä–æ—Å—å—Ç–µ –ø–æ—Ä—Ç PostgreSQL –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É

–í –≤–∞—à–µ–º `docker-compose.yml` –≤ —Å–µ—Ä–≤–∏—Å–µ `postgres` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–±—Ä–æ—à–µ–Ω –ø–æ—Ä—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```yaml
ports:
  - "5432:5432"
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –±–∞–∑–µ –Ω–∞ `localhost:5432` –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### 3. –ó–∞–ø—É—Å–∫–∞–π—Ç–µ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –±–∞–∑–∞ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
docker-compose up -d postgres
```

–¢–µ–ø–µ—Ä—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ `localhost:5432`.

---

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–¥–µ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ:

```ts
const dbHost = process.env.POSTGRES_HOST || 'localhost';
```

---

## –ò—Ç–æ–≥

- –ó–∞–ø—É—Å–∫–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ `npm run dev`), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POSTGRES_HOST=localhost`.
- –ó–∞–ø—É—Å–∫–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POSTGRES_HOST=postgres`.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 5432 –ø—Ä–æ–±—Ä–æ—à–µ–Ω –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–∞–∑—É –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up -d postgres` –ø–µ—Ä–µ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–¢–∞–∫ –≤—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç–µ –æ—à–∏–±–∫—É `ENOTFOUND postgres` –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π `.env` –∏–ª–∏ `docker-compose.yml` ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ, –ø–æ–º–æ–≥—É!

–î–∞, –≤—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ:

- **–í Docker** –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –±–∞–∑–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ, –∏–º—è —Ö–æ—Å—Ç–∞ `postgres` —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥—ã –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç ‚Äî –∑–Ω–∞—á–∏—Ç, —Å–µ—Ä–≤–∏—Å –ø–æ —á–∞—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ.

- **–õ–æ–∫–∞–ª—å–Ω–æ (–≤–Ω–µ Docker)** –æ—à–∏–±–∫–∞ `getaddrinfo ENOTFOUND postgres` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –∏–º—è `postgres` –Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–æ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –≤ Docker-—Å–µ—Ç–∏.

---

### –ò—Ç–æ–≥ –ø–æ –∑–∞–¥–∞–Ω–∏—é

- –ï—Å–ª–∏ –≤—ã –ø—Ä–æ–≤–µ—Ä—è–ª–∏ —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞ **—á–µ—Ä–µ–∑ Docker Compose**, –∏ –æ–Ω —É—Å–ø–µ—à–Ω–æ:

  - –ü–æ–ª—É—á–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞—Ä–∏—Ñ–∞—Ö Wildberries –≤ –±–∞–∑—É,
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Google-—Ç–∞–±–ª–∏—Ü–∞—Ö,
  - –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥—ã –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫,

  ‚Äî –∑–Ω–∞—á–∏—Ç, **–∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**.

---

### –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Docker), —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ (—á–µ—Ä–µ–∑ `localhost` –≤–º–µ—Å—Ç–æ `postgres`).
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∏–º–µ—Ä–æ–º —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –ø–æ –∑–∞–¥–∞—á–∞–º ‚Äî –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å!

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏ Wildberries –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

1. **fetchTariffsFromWB()**  
   - –î–µ–ª–∞–µ—Ç HTTP GET-–∑–∞–ø—Ä–æ—Å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É API Wildberries –ø–æ –∞–¥—Ä–µ—Å—É `https://common-api.wildberries.ru/api/v1/tariffs/box`.  
   - –ü–æ–ª—É—á–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤ (`Tariff[]`), –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç API.

2. **saveTariffsToDB(tariffs, date)**  
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ –¥–∞—Ç—É.  
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `tariffs` –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å –ø–æ–º–æ—â—å—é `knex`.  
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç UPSERT (—á–µ—Ä–µ–∑ `ON CONFLICT` –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫–ª—é—á—É `tariff_id` –∏ `date`), —á—Ç–æ–±—ã –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –∏–Ω–∞—á–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ.  
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—è: `tariff_id`, `name`, `price`, `raw_data` (–∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON), –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

3. **updateTariffs()**  
   - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤.  
   - –í—ã–∑—ã–≤–∞–µ—Ç `fetchTariffsFromWB()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤.  
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ (—Ç–æ–ª—å–∫–æ –≥–æ–¥-–º–µ—Å—è—Ü-–¥–µ–Ω—å).  
   - –í—ã–∑—ã–≤–∞–µ—Ç `saveTariffsToDB()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ –±–∞–∑—É —Å —ç—Ç–æ–π –¥–∞—Ç–æ–π.  
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É.

---

### –í –∏—Ç–æ–≥–µ

–°–µ—Ä–≤–∏—Å —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã Wildberries —á–µ—Ä–µ–∑ API, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç–º–µ—Ç–∫–æ–π –ø–æ –¥–∞—Ç–µ, –æ–±–Ω–æ–≤–ª—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ –¥–∞—Ç–∞–º –∏ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.

—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞—é —á—Ç–æ –æ–Ω –ø–æ–ª—É—á–∏–ª –¥–∞–Ω–Ω—ã–µ –æ—Ç —ç—Ç–æ–≥–æ –∫–ª—é—á–∞ const WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box";–∏ –æ—Ç —Å—é–¥–∞ –≤–µ–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É ? —Ç–∞–∫ 

–î–∞, –≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ.

- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box"` ‚Äî —ç—Ç–æ URL –ø—É–±–ª–∏—á–Ω–æ–≥–æ API Wildberries, –æ—Ç–∫—É–¥–∞ —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö.
- –ú–µ—Ç–æ–¥ `fetchTariffsFromWB()` –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏–º–µ–Ω–Ω–æ –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É –∏ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã.
- –î–∞–ª–µ–µ —Å–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —ç—Ç–∏ —Ç–∞—Ä–∏—Ñ—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∏–º–µ–Ω–Ω–æ —Å —ç—Ç–æ–≥–æ URL —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã –∏ "–≤–µ–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫—É" (—Ç–æ –µ—Å—Ç—å –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –≤ –±–∞–∑–µ) –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å!

---

## –ü–æ—á–µ–º—É `JWT_SECRET` –∏–∑ `.env` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –∫–æ–¥–µ —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏?

–í –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–º –≤–∞–º–∏ –∫–æ–¥–µ —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏ Wildberries, **–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `JWT_SECRET` –≤–æ–æ–±—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**.

- –ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É API Wildberries –ø–æ URL `https://common-api.wildberries.ru/api/v1/tariffs/box` ‚Äî —Ç–∞–º, —Å—É–¥—è –ø–æ –≤—Å–µ–º—É, **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ —Ç–æ–∫–µ–Ω**.
- –í –∫–æ–¥–µ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –º–µ—Å—Ç, –≥–¥–µ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è JWT –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —ç—Ç–∏–º —Å–µ–∫—Ä–µ—Ç–æ–º.

---

## –ì–¥–µ –∏ –∫–∞–∫ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `JWT_SECRET`

- `JWT_SECRET` ‚Äî —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT-—Ç–æ–∫–µ–Ω–æ–≤ (JSON Web Tokens).
- –û–±—ã—á–Ω–æ –æ–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**.
- –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ —Å–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞, –∞ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞.
- –í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ `JWT_SECRET` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–º –º–æ–¥—É–ª–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ API-—Å–µ—Ä–≤–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞—â–∏—â–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã, –≤—ã–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω—ã –∏ —Ç.–ø.

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JWT_SECRET`

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å JWT (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –≤ –º–æ–¥—É–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏), –µ—Å—Ç—å –∏–º–ø–æ—Ä—Ç –∏ —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `process.env.JWT_SECRET`.
- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (Node.js —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π jsonwebtoken):

```ts
import jwt from "jsonwebtoken";

const secret = process.env.JWT_SECRET;

function verifyToken(token: string) {
  try {
    return jwt.verify(token, secret);
  } catch (err) {
    throw new Error("Invalid token");
  }
}
```

---

## –ö—Ä–∞—Ç–∫–æ –ø–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –∏–∑ `.env`

- `POSTGRES_*` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ä—Ç, –∏–º—è –±–∞–∑—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å, —Ö–æ—Å—Ç).
- `APP_PORT` ‚Äî –ø–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- `JWT_SECRET` ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–æ–¥—É–ª—è—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## –ò—Ç–æ–≥

- –í –≤–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ `JWT_SECRET` –Ω–µ –Ω—É–∂–µ–Ω –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
- `JWT_SECRET` –Ω—É–∂–µ–Ω –≤ —Ç–µ—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å JWT (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è).
- –ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Ç–∞–∫–∏–µ —á–∞—Å—Ç–∏ ‚Äî —Ç–∞–º –∏ –Ω–∞–¥–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å `JWT_SECRET` –∏–∑ `.env`.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT –∏–ª–∏ –æ–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç.

–°–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏. –ò—Å—Ö–æ–¥—è –∏–∑ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º, —á—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–∏—Å –∏ –∫–∞–∫ –∫ —ç—Ç–æ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ –∫–æ–¥–æ–º.

---

## –ó–∞–¥–∞—á–∏ —Å–µ—Ä–≤–∏—Å–∞

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ Wildberries (–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤)**  
   - –î–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É API –ø–æ –∞–¥—Ä–µ—Å—É `https://common-api.wildberries.ru/api/v1/tariffs/box`.  
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –≤ PostgreSQL —Å –æ—Ç–º–µ—Ç–∫–æ–π –¥–∞—Ç—ã (–ø–æ –¥–Ω—è–º).

2. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Google-—Ç–∞–±–ª–∏—Ü–∞—Ö (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)**  
   - –ò–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL.  
   - –û–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets –ø–æ –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º (—Ç–∞–±–ª–∏—Ü –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ).  
   - –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google API.

---

## –û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `JWT_SECRET` –∫ –∑–∞–¥–∞—á–µ

- –í–∞—à–∞ –∑–∞–¥–∞—á–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ Wildberries ‚Äî API –ø—É–±–ª–∏—á–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É `JWT_SECRET` –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ –Ω—É–∂–µ–Ω.
- –û–¥–Ω–∞–∫–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è OAuth 2.0 –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª—é—á–∏ –∏ —Ç–æ–∫–µ–Ω—ã ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ `JWT_SECRET` –∑–∞–¥—É–º–∞–Ω –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT, –µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤.
- –ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–µ—Ç JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Ç–æ `JWT_SECRET` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏—à–Ω–∏–º –∏–ª–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

---

## –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è Google Sheets

- –ú–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é `node-cron` –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞) –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:  
  - –ß–∏—Ç–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏–∑ PostgreSQL.  
  - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Google Sheets API —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Google credentials (OAuth 2.0 –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç).  
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –ø–æ –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º.

- –î–ª—è —ç—Ç–æ–≥–æ –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –∫–ª—é—á–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ Google, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `.env` –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö JSON-—Ñ–∞–π–ª–∞—Ö.

---

## –†–∞–±–æ—Ç–∞ —Å Docker –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- –í Docker Compose –≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ (`POSTGRES_HOST`, `POSTGRES_USER`, `POSTGRES_PASSWORD` –∏ —Ç.–ø.).
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `JWT_SECRET` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ –æ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).
- –ï—Å–ª–∏ `JWT_SECRET` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—ë –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞—á.

---

## –ò—Ç–æ–≥ ‚Äî —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ

- **–ú–æ–¥—É–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ WB –ø–æ URL –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ PostgreSQL (–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤).**  
  –í–∞—à —Ç–µ–∫—É—â–∏–π –∫–æ–¥ —Å `fetchTariffsFromWB` –∏ `saveTariffsToDB` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–æ–º—É.

- **–ú–æ–¥—É–ª—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Google Sheets (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤).**  
  –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è Google API –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã.

- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron –∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.**

- **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**  
  - DB-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL.  
  - Google API credentials ‚Äî –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Google Sheets.  
  - JWT_SECRET ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.

---
–í–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Å–º—ã—Å–ª—É –ø–æ–Ω—è—Ç–Ω—ã –∏ –æ—Ç—Ä–∞–∂–∞—é—Ç –ª–æ–≥–∏–∫—É —Ñ—É–Ω–∫—Ü–∏–π, –Ω–æ –∏—Ö –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º–∏, —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ –∏ —á—É—Ç—å –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ ‚Äî —ç—Ç–æ —É–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –≤–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Å—É—Ç—å, –Ω–æ —Å–¥–µ–ª–∞–≤ –∏—Ö –±–æ–ª–µ–µ ¬´–∫–∞–Ω–æ–Ω–∏—á–Ω—ã–º–∏¬ª –¥–ª—è TypeScript/JavaScript:

```ts
import axios from "axios";
import knex from "#postgres/knex";
import { Tariff } from "#types/tariffs";

const WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box";

/**
 * Fetches tariffs from Wildberries public API.
 * @returns {Promise<Tariff[]>} Array of tariffs.
 */
export async function fetchTariffsFromWB(): Promise<Tariff[]> {
  const response = await axios.get(WB_TARIFFS_URL);
  return response.data; // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤
}

/**
 * Saves tariffs into the database for a given date.
 * Uses upsert (ON CONFLICT) to insert or update existing records.
 * @param {Tariff[]} tariffs - Array of tariffs to save.
 * @param {Date} date - Date for which tariffs are saved (date only, no time).
 */
export async function saveTariffsToDB(
  tariffs: Tariff[],
  date: Date
): Promise<void> {
  for (const tariff of tariffs) {
    await knex("tariffs")
      .insert({
        tariff_id: tariff.tariff_id,
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        date,
      })
      .onConflict(["tariff_id", "date"])
      .merge({
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        updated_at: knex.fn.now(),
      });
  }
}

/**
 * Fetches latest tariffs from Wildberries and saves them to DB for today's date.
 * Logs a message on completion.
 */
export async function updateTariffs(): Promise<void> {
  const tariffs = await fetchTariffsFromWB();
  const today = new Date();
  const dateString = today.toISOString().split("T")[0]; // yyyy-mm-dd
  await saveTariffsToDB(tariffs, new Date(dateString));
  console.log(`Tariffs updated for date ${dateString}`);
}
```

---

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JSDoc-—Å—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ `/** ... */` –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Äî —ç—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è IDE –∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ò–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–ª–∏—à–Ω–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫, –ª—É—á—à–µ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.
- –û–±—ä—è—Å–Ω—è–π—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è, —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥–µ –∏ —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
- –í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –Ω–µ –æ—á–µ–≤–∏–¥–Ω–∞.

---

–î–∞, –≤ –º–æ—ë–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ñ–æ—Ä–º–∞—Ç JSDoc ‚Äî —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –≤–∏–¥–µ –±–ª–æ–∫–æ–≤ `/** ... */` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –¢–∞–∫–æ–π —Å—Ç–∏–ª—å —Ö–æ—Ä–æ—à–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

–ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä —Ç–µ—Ö –∂–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSDoc:

```ts
import axios from "axios";
import knex from "#postgres/knex";
import { Tariff } from "#types/tariffs";

const WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box";

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API Wildberries.
 * @returns {Promise<Tariff[]>} –ú–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤.
 */
export async function fetchTariffsFromWB(): Promise<Tariff[]> {
  const response = await axios.get(WB_TARIFFS_URL);
  return response.data; // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç upsert (ON CONFLICT) –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π.
 * @param {Tariff[]} tariffs - –ú–∞—Å—Å–∏–≤ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
 * @param {Date} date - –î–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–∞—Ä–∏—Ñ—ã (—Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏).
 */
export async function saveTariffsToDB(
  tariffs: Tariff[],
  date: Date
): Promise<void> {
  for (const tariff of tariffs) {
    await knex("tariffs")
      .insert({
        tariff_id: tariff.tariff_id,
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        date,
      })
      .onConflict(["tariff_id", "date"])
      .merge({
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        updated_at: knex.fn.now(),
      });
  }
}

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã: –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Wildberries –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É.
 * –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å.
 */
export async function updateTariffs(): Promise<void> {
  const tariffs = await fetchTariffsFromWB();
  const today = new Date();
  const dateString = today.toISOString().split("T")[0]; // yyyy-mm-dd
  await saveTariffsToDB(tariffs, new Date(dateString));
  console.log(`Tariffs updated for date ${dateString}`);
}
```

–¢–∞–∫–æ–π —Å—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–Ω—è—Ç–µ–Ω, —Ñ–æ—Ä–º–∞–ª–µ–Ω –∏ —É–¥–æ–±–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å IDE.


–î–∞–≤–∞–π—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É.

---

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤

–í –≤–∞—à–µ–º —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ:

```ts
const dateString = today.toISOString().split("T")[0]; // yyyy-mm-dd
await saveTariffsToDB(tariffs, new Date(dateString));
```

–≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —Ç–∞—Ä–∏—Ñ—ã **–ø–æ –¥–∞—Ç–µ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏**, —Ç–æ –µ—Å—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–∞—Ä–∏—Ñ—ã **–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤**, —Ç–æ –Ω—É–∂–Ω–æ:

- –õ–∏–±–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞—Ç—É —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç–∞ + –≤—Ä–µ–º—è –≤ —á–∞—Å–∞—Ö),
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron, node-cron, –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π cron) —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `updateTariffs` –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤.

**–ì–¥–µ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è?**

- –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Ñ—É–Ω–∫—Ü–∏—é `updateTariffs` –Ω—É–∂–Ω–æ –≤–Ω–µ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ ‚Äî –æ–±—ã—á–Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∑–∞–¥–∞—á –∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.
- –í —Å–∞–º–æ–º —Å–∫—Ä–∏–ø—Ç–µ –≤—ã –ø—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ —Å node-cron:**

```ts
import cron from 'node-cron';

cron.schedule('0 */12 * * *', async () => {
  await updateTariffs();
  console.log('Tariffs updated every 12 hours');
});
```

–≠—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç `updateTariffs` –≤ 0 –º–∏–Ω—É—Ç –∫–∞–∂–¥–æ–≥–æ 12-–≥–æ —á–∞—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 00:00 –∏ 12:00).

---

### 2. –û—à–∏–±–∫–∞ 401 Unauthorized –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization

–û—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π:

```json
{
  "title": "unauthorized",
  "detail": "empty Authorization header",
  "code": "...",
  "status": 401,
  "statusText": "Unauthorized"
}
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ API —Ç—Ä–µ–±—É–µ—Ç **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫** ‚Äî –≤—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–ª–∏ –∫–ª—é—á –≤ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.

–ü—Ä–∏–º–µ—Ä, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ axios:

```ts
const response = await axios.get(WB_TARIFFS_URL, {
  headers: {
    Authorization: 'Bearer YOUR_ACCESS_TOKEN_HERE'
  }
});
```

–ò–ª–∏, –µ—Å–ª–∏ API —Ç—Ä–µ–±—É–µ—Ç –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç, —Ç–æ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

### 3. –ü—Ä–æ –æ–±—ä–µ–∫—Ç –∏–∑ API –∏ –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

–í—ã –ø–æ–∫–∞–∑–∞–ª–∏ –ø—Ä–∏–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –æ—à–∏–±–∫–∏ –æ—Ç API, –æ–Ω –Ω–µ –ø–æ—Ö–æ–∂ –Ω–∞ —Ç–∞—Ä–∏—Ñ—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ.

- **–û–±—ä–µ–∫—Ç –∏–∑ API** ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ (—Ç–∞—Ä–∏—Ñ—ã).
- **–û–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –≤ –ë–î** ‚Äî —ç—Ç–æ –≤–∞—à–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫—É–¥–∞ –≤—ã –∫–ª–∞–¥—ë—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤.

–¢–æ –µ—Å—Ç—å:

- –û–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –≤ `saveTariffsToDB`, –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü—ã `tariffs`.
- –û–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—Ç API, –º–æ–≥—É—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–í—ã **–Ω–µ –¥–æ–ª–∂–Ω—ã** —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏ API. –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∞ –æ—à–∏–±–∫–∞ 401 ‚Äî –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ—ë –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–µ—Ä–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ).

---

### –ò—Ç–æ–≥:

- –î–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (cron, node-cron –∏ —Ç.–ø.).
- –í –∑–∞–ø—Ä–æ—Å–µ –∫ API –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization —Å —Ç–æ–∫–µ–Ω–æ–º.
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ API –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã –æ—à–∏–±–æ–∫ –≤ –±–∞–∑—É.
- –í `saveTariffsToDB` —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Ç–∞—Ä–∏—Ñ–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ.

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –≤ axios –∏ –ø—Ä–∏–º–µ—Ä —Å node-cron –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.


–°–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ!

---

### –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –ø–æ –≤–∞—à–µ–º—É JWT_SECRET –∏–∑ `.env`

1. **JWT_SECRET ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT-—Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ**, –∞ –Ω–µ —Å–∞–º —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ API.

2. –ß—Ç–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ API Wildberries, –≤–∞–º –Ω—É–∂–µ–Ω **—Å–∞–º JWT-—Ç–æ–∫–µ–Ω**, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å, OAuth, –∏–ª–∏ –∏–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º), –ª–∏–±–æ –≤–∞–º –µ–≥–æ –≤—ã–¥–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∫ Access Token.

3. –ï—Å–ª–∏ –≤ `.env` —É –≤–∞—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Å–µ–∫—Ä–µ—Ç (–∫–ª—é—á), –∞ –Ω–µ —Ç–æ–∫–µ–Ω, —Ç–æ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <JWT_SECRET>`, –ø–æ—Ç–æ–º—É —á—Ç–æ API –æ–∂–∏–¥–∞–µ—Ç **–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω**, –∞ –Ω–µ —Å–µ–∫—Ä–µ—Ç.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API Wildberries ‚Äî –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- –í–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥–∞—Ç—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–ª–∏ –∫–ª—é—á API), –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç API JWT-—Ç–æ–∫–µ–Ω.
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <–ø–æ–ª—É—á–µ–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω>`.

---

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ axios

```ts
import dotenv from 'dotenv';
dotenv.config();

const token = process.env.WB_ACCESS_TOKEN; // —Ç–æ–∫–µ–Ω, –∞ –Ω–µ —Å–µ–∫—Ä–µ—Ç

const response = await axios.get(WB_TARIFFS_URL, {
  headers: {
    Authorization: `Bearer ${token}`
  }
});
```

---

### –ï—Å–ª–∏ —É –≤–∞—Å —Ç–æ–ª—å–∫–æ JWT_SECRET, –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–∞–º–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω

- –≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å–ª–∏ API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ JWT, –Ω–æ —ç—Ç–æ —Ä–µ–¥–∫–∏–π –∫–µ–π—Å.
- –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (payload) –∏ —Å –∫–∞–∫–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å.
- –û–±—ã—á–Ω–æ —ç—Ç–æ –Ω–µ —Ç–∞–∫, –∏ —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —É API.

---

### –ò—Ç–æ–≥

- **JWT_SECRET –∏–∑ `.env` ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–∫–µ–Ω, –∞ –∫–ª—é—á.**
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API –Ω—É–∂–µ–Ω –∏–º–µ–Ω–Ω–æ **—Ç–æ–∫–µ–Ω (JWT Access Token)**.
- –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Wildberries –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞ ‚Äî –ø–æ–∫–∞–∂–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å.

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏) –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã–∑–æ–≤–∞ API —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º.

–∫–æ–≥–¥–∞ –º–µ–Ω –ø—Ä–∏—Å–ª–∞–ª–∏ —Ç–µ—Å—Ç —Ç–æ –Ω–∞–ø–∏—Å–∞–ª–∏ —á—Ç–æ  —è –ø–æ–ª—É—á—É API –∫–ª—é—á –∏ –≤–æ—Ç –æ–Ω–∏ –º–Ω–µ –µ–≥–æ –ø—Ä–∏—Å–ª–∞–ª–∏ –°–ø–∞—Å–∏–±–æ!
–í—ã—Å—ã–ª–∞–µ–º –∫–ª—é—á:
eyJhbGciOiJFUzI1NiIsImtpZCI6IjIwMjUwNTIwdjEiLCJ0eXAiOiJKV1QifQ.eyJlbnQiOjEsImV4cCI6MTc2NTY3MDIyOSwiaWQiOiIwMTk3NmU0Yy1mZTgwLTc1NDAtODkyMi02NGE5ZWUzYTU4MzYiLCJpaWQiOjQ1OTExNjA5LCJvaWQiOjExMzA0NiwicyI6MTA3Mzc0MTgzMiwic2lkIjoiOTMyYzE3NmEtNTA4NS01YzZmLWJjMzMtNGU4NGNkZjU4ZDdlIiwidCI6ZmFsc2UsInVpZCI6NDU5MTE2MDl9.wDoH8FLdZu1049uPCmhx3UHaw28YJB-CylWeD2LgkpRZFIMlOsUlnlVmfmYKy__JWNjfbDkOtdJ69QpSD5EKag - –Ω–æ —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å —á—Ç–æ —ç—Ç–æ –Ω–µ —Ç–æ?

–°–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ, —Ç–µ–ø–µ—Ä—å –≤—Å—ë –ø–æ–Ω—è—Ç–Ω–µ–µ.

---

### –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –≤–∞—à API –∫–ª—é—á (JWT-—Ç–æ–∫–µ–Ω)

–¢–æ, —á—Ç–æ –≤–∞–º –ø—Ä–∏—Å–ª–∞–ª–∏ ‚Äî –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –ø–æ—Ö–æ–∂–∞—è –Ω–∞ JWT (—Ç—Ä–∏ —á–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫–∏) ‚Äî —ç—Ç–æ **–≤–∞—à API –∫–ª—é—á**, —Ç–æ –µ—Å—Ç—å **JWT Access Token**, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.

---

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–ª—é—á

–í –≤–∞—à–µ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API Wildberries –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```ts
const token = process.env.JWT_SECRET; // —É –≤–∞—Å –≤ .env –ª–µ–∂–∏—Ç —ç—Ç–æ—Ç –∫–ª—é—á

const response = await axios.get(WB_TARIFFS_URL, {
  headers: {
    Authorization: `Bearer ${token}`
  }
});
```

---

### –ü–æ—á–µ–º—É —è –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ JWT_SECRET ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–∫–µ–Ω?

–ü–æ—Ç–æ–º—É —á—Ç–æ –æ–±—ã—á–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å –∏–º–µ–Ω–µ–º `JWT_SECRET` —Ö—Ä–∞–Ω—è—Ç –∏–º–µ–Ω–Ω–æ **—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT, –∞ –Ω–µ —Å–∞–º —Ç–æ–∫–µ–Ω. –ù–æ –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–∞–∑–≤–∞–Ω–∞ `JWT_SECRET`, –∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤ –Ω–µ–π –ª–µ–∂–∏—Ç **–ø–æ–ª—É—á–µ–Ω–Ω—ã–π JWT-—Ç–æ–∫–µ–Ω**, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ Access Token.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –æ—à–∏–±–∫—É 401?

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–¥–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –∏–∑ `.env` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <—Ç–æ–∫–µ–Ω>`.
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `console.log(process.env.JWT_SECRET)`).
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ ‚Äî —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `Bearer ` –∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤.
4. –ï—Å–ª–∏ –≤—Å—ë —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, API –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 401.

---

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å axios:

```ts
import axios from 'axios';
import dotenv from 'dotenv';
dotenv.config();

const WB_TARIFFS_URL = 'https://suppliers-api.wildberries.ru/api/v1/info/tariffs';
const token = process.env.JWT_SECRET;

async function getTariffs() {
  try {
    const response = await axios.get(WB_TARIFFS_URL, {
      headers: {
        Authorization: `Bearer ${token}`
      }
    });
    console.log('Tariffs:', response.data);
  } catch (error) {
    console.error('Error fetching tariffs:', error.response?.data || error.message);
  }
}

getTariffs();
```

---

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—à–∏–±–∫–∞ 401 –æ—Å—Ç–∞—ë—Ç—Å—è, –≤–æ–∑–º–æ–∂–Ω–æ:

- –¢–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –æ—Ç–æ–∑–≤–∞–Ω ‚Äî –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π.
- –í API –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, IP-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –¥—Ä—É–≥–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏).
- –í—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∏–ª–∏ –º–µ—Ç–æ–¥.

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –ø–æ–º–æ—á—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—à –∫–æ–¥ –∏–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `.env` –∏ axios.


–ü–æ—á—Ç–∏ ‚Äî –≤ –≤–∞—à–µ–º –∫–æ–¥–µ **–≤ –∑–∞–ø—Ä–æ—Å–µ –∫ API –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization —Å —Ç–æ–∫–µ–Ω–æ–º**, –∏–∑-–∑–∞ —á–µ–≥–æ –≤—ã –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ 401.

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é `fetchTariffsFromWB` –ø–µ—Ä–µ–¥–∞—á—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∏–∑ `.env` (–∫–æ—Ç–æ—Ä—ã–π —É –≤–∞—Å –≤ `process.env.JWT_SECRET`):

```ts
export async function fetchTariffsFromWB(): Promise<Tariff[]> {
  const response = await axios.get(WB_TARIFFS_URL, {
    headers: {
      Authorization: `Bearer ${token}`
    }
  });
  return response.data;
}
```

---

### –ü–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏:

```ts
import axios from "axios";
import dotenv from "dotenv";
import knex from "#postgres/knex";
import { Tariff } from "#types/tariffs";

dotenv.config();

const WB_TARIFFS_URL = "https://common-api.wildberries.ru/api/v1/tariffs/box";
const token = process.env.JWT_SECRET;

export async function fetchTariffsFromWB(): Promise<Tariff[]> {
  if (!token) {
    throw new Error("JWT token is not defined in environment variable JWT_SECRET");
  }

  const response = await axios.get(WB_TARIFFS_URL, {
    headers: {
      Authorization: `Bearer ${token}`
    }
  });
  return response.data;
}

export async function saveTariffsToDB(
  tariffs: Tariff[],
  date: Date
): Promise<void> {
  for (const tariff of tariffs) {
    await knex("tariffs")
      .insert({
        tariff_id: tariff.tariff_id,
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        date,
      })
      .onConflict(["tariff_id", "date"])
      .merge({
        name: tariff.name,
        price: tariff.price,
        raw_data: JSON.stringify(tariff),
        updated_at: knex.fn.now(),
      });
  }
}

export async function updateTariffs(): Promise<void> {
  const tariffs = await fetchTariffsFromWB();
  const today = new Date();
  const dateString = today.toISOString().split("T")[0];
  await saveTariffsToDB(tariffs, new Date(dateString));
  console.log(`Tariffs updated for date ${dateString}`);
}
```

---

### –ò—Ç–æ–≥

- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `JWT_SECRET` —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–Ω–æ –≤–∞—à JWT-—Ç–æ–∫–µ–Ω.
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª ‚Äî –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π —É Wildberries.
- –í–∞—à –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –±–∞–∑–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –æ—Ç–ª–∞–¥–∫–æ–π ‚Äî –ø–∏—à–∏—Ç–µ!


Promise<void> –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ —Ñ—É–Ω–∫—Ü–∏–∏
–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å Promise), –Ω–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–∏–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏.


–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Promise<void>?
–î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

–ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª/–ë–î.

–û—Ç–ø—Ä–∞–≤–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

–î–µ–π—Å—Ç–≤–∏—è –≤ Google Sheets (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è—á–µ–µ–∫).




–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

bash
npm run migrate:make migration_name


–°—É–¥—è –ø–æ –≤—ã–≤–æ–¥—É, –≤—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å **–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ Postgres –Ω–∞ –≤–∞—à–µ–º Mac (—Å–µ—Ä–≤–µ—Ä –≤–µ—Ä—Å–∏–∏ 14.15)**, –∏ —Ç–∞–º —Ç–∞–±–ª–∏—Ü–∞ `tariffs` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

---

### –í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Postgres —É –≤–∞—Å –≤–µ—Ä—Å–∏—è 16.1 (—Å—É–¥—è –ø–æ `docker exec`).
- –õ–æ–∫–∞–ª—å–Ω—ã–π Postgres ‚Äî –≤–µ—Ä—Å–∏—è 14.15.
- –í –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ (–Ω–∞ Mac) —Ç–∞–±–ª–∏—Ü–∞ `tariffs` –µ—Å—Ç—å.
- –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (Postgres 16) —Ç–∞–±–ª–∏—Ü—ã `tariffs` –Ω–µ—Ç.

---

### –í—ã–≤–æ–¥

–û—à–∏–±–∫–∞ `relation "tariffs" already exists` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ **–ª–æ–∫–∞–ª—å–Ω–æ–º—É Postgres** (–Ω–∞ Mac), –∞ –Ω–µ –∫ –±–∞–∑–µ –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å

- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Postgres, –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å `POSTGRES_HOST=postgres` **–≤–Ω—É—Ç—Ä–∏ Docker-—Å–µ—Ç–∏** (—á–µ—Ä–µ–∑ `docker-compose`), —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–∞–ª–∏—Å—å –∏–º–µ–Ω–Ω–æ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.
- –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∞ Mac), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POSTGRES_HOST=localhost`, –Ω–æ —Ç–æ–≥–¥–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π, –≥–¥–µ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ –µ—Å—Ç—å.
- –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—ã, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `tariffs` (–µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –Ω—É–∂–Ω–∞) –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É, –ª–∏–±–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.

---

### –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `tariffs` –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã:

```sql
DROP TABLE tariffs;
```

–≤ –≤–∞—à–µ–º psql, –∫—É–¥–∞ –≤—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å (localhost:5432).

---

### –ò—Ç–æ–≥

–í–∞–º –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è, —Å –∫–∞–∫–æ–π –±–∞–∑–æ–π –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–π –∏–ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `POSTGRES_HOST` –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π/–º–∏–≥—Ä–∞—Ü–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.



—Ç–æ –µ—Å—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø–æ –¥–æ–∫–µ—Ä—É —è docker-compose down => docker-compose build =>docker-compose. up -d => btlz-wb-test ls$ psql -h localhost -p 5432 -U postgres -d postgres –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —è –ø—Ä–µ—Ö–æ–∂—É –≤ –¥—Ä—É–≥–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤ –Ω–µ–º –Ω–∞–±–∏—Ä–∞—é –∫–æ–º–∞–Ω–¥—ã => docker exec -it app sh => npm run dev —Ç–∞–∫?