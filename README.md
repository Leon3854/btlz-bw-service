# btlz-bw-service
--------------------------------------------
## Цель задачи
-------------------------------------------

**Разработать сервис, который:**

- Регулярно получает информацию о тарифах Wildberries для коробов с публичного API.
- Сохраняет тарифы в PostgreSQL с накоплением данных по дням.
- Регулярно обновляет данные о тарифах в произвольном количестве Google-таблиц.
- Запускается и работает в Docker-контейнерах с использованием docker compose up.
____________________________________________________________________________________

### Реализация
1. **Настройка Docker**
- Создан Dockerfile для сборки образа приложения на Node.js.
- Подготовлен docker-compose.yml, который запускает два сервиса:
 app — приложение на Node.js.
 postgres — база данных PostgreSQL с дефолтными параметрами (user: postgres, password: postgres, database: postgres).
- Обеспечена возможность запуска всего проекта одной командой:

`docker compose up -d`
______________________________________________________________________________________

2. **Работа с API Wildberries**
   
- Использован endpoint: https://common-api.wildberries.ru/api/v1/tariffs/box.
- Разобрана структура API, выбраны необходимые поля для хранения.
- Написан модуль для регулярного (ежечасного) получения данных с использованием node-cron (или аналогичного планировщика).
- При получении данных:
- Если данные за текущий день отсутствуют — создаются новые записи.
- Если данные за день уже есть — происходит обновление существующих записей.
______________________________________________________________________________________

3. ###Работа с базой данных PostgreSQL### 
Использована библиотека knex.js для работы с СУБД.
Созданы миграции для таблиц, отражающих структуру тарифов.
Для типизации и описания структур данных применён TypeScript (или jsDoc).
Данные о тарифах аккумулируются с привязкой к дате.
---------------------------------------------------------------------------------------

4. ###Интеграция с Google-таблицами###
Реализован механизм обновления данных из PostgreSQL в Google-таблицы по их идентификаторам.
Количество таблиц - произвольное (N).
Использован Google Sheets API для обновления листа stocks_coefs в каждой таблице.
Данные сортируются по возрастанию коэффициента перед загрузкой в таблицы.
Обновление данных в таблицах происходит регулярно, синхронизируясь с обновлением в БД.
-----------------------------------------------------------------------------------------

5. ###Запуск и проверка###
В репозиторий добавлены шаблоны конфигурационных файлов .env.example с указанием необходимых переменных (без чувствительных данных).
Для запуска достаточно выполнить:
docker compose up -d
Для проверки работы:
В логах контейнера app отображается процесс миграций и обновления данных.
Можно подключиться к базе данных и проверить наличие актуальных записей тарифов.
Проверить Google-таблицы на наличие обновлённых данных в листе stocks_coefs.

