

# btlz-bw-service

---

## Важное сообщение

Хочу искренне поблагодарить за предоставленную возможность выполнить тестовое задание и принести извинения за задержку с его сдачей.  
В процессе работы возникли сложности с миграциями и некоторыми деталями, которые я тщательно проработал и решил.  
Все изменения и комментарии к коду добавлены для удобства проверки и понимания логики.  
Спасибо за понимание и продлённое ожидание!

---

## О проекте

Сервис предназначен для регулярного получения тарифов Wildberries для коробов с публичного API, сохранения данных в PostgreSQL с накоплением по дням и обновления информации в произвольном количестве Google-таблиц.

---

## Основные функции

- Получение тарифов Wildberries по API с периодичностью (ежечасно).
- Сохранение и обновление тарифов в базе данных PostgreSQL.
- Обновление данных в Google-таблицах (лист `stocks_coefs`) по идентификаторам.
- Запуск и работа в Docker-контейнерах с использованием `docker compose up`.

---

## Запуск проекта

1. Клонируйте репозиторий и перейдите в его директорию.

2. Создайте файл `.env` на основе `.env.example`, заполнив необходимые переменные окружения.

3. Для запуска используйте команду:

```bash
docker compose up -d


## Важное сообщение

Хочу искренне поблагодарить за предоставленную возможность выполнить тестовое задание и принести извинения за задержку с его сдачей.  
В процессе работы возникли сложности с миграциями и некоторыми деталями, которые я тщательно проработал и решил.  
Все изменения и комментарии к коду добавлены в ветке testing для удобства проверки и понимания логики.  
Спасибо за понимание и продлённое ожидание!

## О проекте

Сервис предназначен для регулярного получения тарифов Wildberries для коробов с публичного API, сохранения данных в PostgreSQL с 
накоплением по дням и обновления информации в произвольном количестве Google-таблиц.

## Цель задачи
-------------------------------------------

**Разработать сервис, который:**

- Регулярно получает информацию о тарифах Wildberries для коробов с публичного API.
- Сохраняет тарифы в PostgreSQL с накоплением данных по дням.
- Регулярно обновляет данные о тарифах в произвольном количестве Google-таблиц.
- Запускается и работает в Docker-контейнерах с использованием docker compose up.
____________________________________________________________________________________

### Реализация
1. **Настройка Docker**
- Создан Dockerfile для сборки образа приложения на Node.js.
- Подготовлен docker-compose.yml, который запускает два сервиса:
 app — приложение на Node.js.
 postgres — база данных PostgreSQL с дефолтными параметрами (user: postgres, password: postgres, database: postgres).
- Обеспечена возможность запуска всего проекта одной командой:

`docker compose up -d`
______________________________________________________________________________________

2. **Работа с API Wildberries**
   
- Использован endpoint: https://common-api.wildberries.ru/api/v1/tariffs/box.
- Разобрана структура API, выбраны необходимые поля для хранения.
- Написан модуль для регулярного (ежечасного) получения данных с использованием node-cron (или аналогичного планировщика).
- При получении данных:
- Если данные за текущий день отсутствуют — создаются новые записи.
- Если данные за день уже есть — происходит обновление существующих записей.
______________________________________________________________________________________

3. **Работа с базой данных PostgreSQL** 
Использована библиотека knex.js для работы с СУБД.
Созданы миграции для таблиц, отражающих структуру тарифов.
Для типизации и описания структур данных применён TypeScript (или jsDoc).
Данные о тарифах аккумулируются с привязкой к дате.
---------------------------------------------------------------------------------------

4. **Интеграция с Google-таблицами**
Реализован механизм обновления данных из PostgreSQL в Google-таблицы по их идентификаторам.
Количество таблиц - произвольное (N).
Использован Google Sheets API для обновления листа stocks_coefs в каждой таблице.
Данные сортируются по возрастанию коэффициента перед загрузкой в таблицы.
Обновление данных в таблицах происходит регулярно, синхронизируясь с обновлением в БД.
-----------------------------------------------------------------------------------------

5. **Запуск и проверка**
В репозиторий добавлены шаблоны конфигурационных файлов .env.example с указанием необходимых переменных (без чувствительных данных).
Для запуска достаточно выполнить:

`docker compose up -d`

Для проверки работы:
В логах контейнера app отображается процесс миграций и обновления данных.
Можно подключиться к базе данных и проверить наличие актуальных записей тарифов.
Проверить Google-таблицы на наличие обновлённых данных в листе stocks_coefs.

---------------------------------------------------------------------------------------

6. **Запуск и**
В репозиторий добавлены шаблоны конфигурационных файлов .env.example с указанием необходимых переменных (без чувствительных данных).
Для запуска достаточно выполнить:

`docker compose up -d`


## Структура репозитория
- /src — исходный код приложения
- /migrations — миграции БД
- docker-compose.yml — конфигурация Docker
- Dockerfile — описание образа приложения
- .env.example — пример файла с переменными окружения
- README.md — инструкция по запуску и описание проекта




